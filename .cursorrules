# Interior Inspiration Website Tech Stack and Project Structure

## Project Type
- Static Website (SSG - Static Site Generation)
- Important Notes:
  - All pages are pre-rendered at build time
  - No server-side operations after deployment
  - Content updates require rebuild and redeploy
  - Build output is in /out directory

## Tech Stack
- Framework: Next.js 13.5.8 (App Router)
- Language: TypeScript
- Styling: Tailwind CSS 3.3.6
- Content Management: 
  - MDX (with @mdx-js)
  - Contentlayer
  - next-mdx-remote
- UI Components:
  - @headlessui/react
  - @heroicons/react
  - react-icons
- Image Processing: Cloudinary
- Development Tools:
  - ESLint
  - PostCSS
  - TypeScript
  - ts-node

## MDX æŠ€è¡“é¸æ“‡æ­·å²èˆ‡æ±ºç­–éç¨‹

### èƒŒæ™¯ï¼šNext.js 13 æ—©æœŸçš„ MDX ç›¸å®¹æ€§å•é¡Œ
åœ¨ Next.js 13 å‰›ç™¼å¸ƒæ™‚ï¼ˆç‰¹åˆ¥æ˜¯ App Router é‚„åœ¨ beta éšæ®µï¼‰ï¼ŒMDX æ•´åˆå­˜åœ¨é‡å¤§ç›¸å®¹æ€§å•é¡Œã€‚

### æŠ€è¡“é¸æ“‡æ¼”é€²éç¨‹

#### 1. ç¬¬ä¸€æ¬¡å˜—è©¦ï¼š`@next/mdx`ï¼ˆå®˜æ–¹åŒ…ï¼‰
**é¸æ“‡åŸå› **ï¼šå®˜æ–¹æ¨è–¦çš„ MDX è§£æ±ºæ–¹æ¡ˆ
**é‡åˆ°çš„å•é¡Œ**ï¼š
- å° Next.js 13 App Router æ”¯æ´æ¥µå·®ï¼Œbug çœ¾å¤š
- éœæ…‹åŒ¯å‡ºï¼ˆ`output: 'export'`ï¼‰åŠŸèƒ½ä¸ç©©å®š
- Server Components æ•´åˆæœ‰åš´é‡å•é¡Œ
- éœ€è¦ `mdx-components.tsx` ä½†å®˜æ–¹æ–‡æª”ä¸æ¸…æ¥š
- ç·¨è­¯æ™‚ç¶“å¸¸å‡ºç¾è«åéŒ¯èª¤

**çµè«–**ï¼šâŒ æ”¾æ£„ï¼Œå› ç‚º bug å¤ªå¤šç„¡æ³•ç”¨æ–¼ç”Ÿç”¢ç’°å¢ƒ

#### 2. ç¬¬äºŒæ¬¡å˜—è©¦ï¼š`next-mdx-remote`ï¼ˆç¤¾ç¾¤åŒ…ï¼‰
**é¸æ“‡åŸå› **ï¼šç¤¾ç¾¤åŒ…å° Next.js 13 ç›¸å®¹æ€§æ›´å¥½
**å„ªé»**ï¼š
- âœ… è§£æ±ºäº† Next.js 13 App Router ç›¸å®¹æ€§å•é¡Œ
- âœ… æ›´éˆæ´»çš„å…§å®¹è¼‰å…¥æ–¹å¼
- âœ… å¯ä»¥å¾ä»»ä½•ä¾†æºï¼ˆAPIã€CMSã€æª”æ¡ˆç³»çµ±ï¼‰è¼‰å…¥ MDX

**è‡´å‘½ç¼ºé»**ï¼š
- âŒ **ä¸æ”¯æ´éœæ…‹ç¶²ç«™ç”Ÿæˆ**ï¼ˆ`output: 'export'`ï¼‰
- âŒ æ˜¯**åŸ·è¡Œæ™‚ç·¨è­¯**ï¼Œéœ€è¦ä¼ºæœå™¨ç’°å¢ƒ
- âŒ ç„¡æ³•åœ¨ç´”éœæ…‹ç¶²ç«™ä¸­ä½¿ç”¨

**æŠ€è¡“åŸç†**ï¼š
```typescript
// next-mdx-remote çš„å·¥ä½œæ–¹å¼
const mdxSource = await serialize(content) // éœ€è¦ Node.js åŸ·è¡Œæ™‚ç’°å¢ƒ
<MDXRemote {...mdxSource} />              // å®¢æˆ¶ç«¯æˆ–ä¼ºæœå™¨ç«¯å‹•æ…‹ç·¨è­¯
```

**çµè«–**ï¼šâŒ æ”¾æ£„ï¼Œå› ç‚ºå°ˆæ¡ˆéœ€æ±‚æ˜¯éœæ…‹ç¶²ç«™

#### 3. æœ€çµ‚é¸æ“‡ï¼š`Contentlayer`
**é¸æ“‡åŸå› **ï¼šå°ˆç‚ºéœæ…‹ç¶²ç«™å’Œ Next.js 13 è¨­è¨ˆçš„è§£æ±ºæ–¹æ¡ˆ
**å®Œç¾è§£æ±ºæ‰€æœ‰å•é¡Œ**ï¼š
- âœ… å®Œå…¨æ”¯æ´ Next.js 13 App Router
- âœ… å®Œç¾æ”¯æ´éœæ…‹ç¶²ç«™ç”Ÿæˆï¼ˆ`output: 'export'`ï¼‰
- âœ… **ç·¨è­¯æ™‚è™•ç†**ï¼ˆä¸æ˜¯åŸ·è¡Œæ™‚ï¼‰ï¼Œé©åˆéœæ…‹ç¶²ç«™
- âœ… è‡ªå‹•ç”Ÿæˆ TypeScript å‹åˆ¥å®šç¾©
- âœ… å„ªç§€çš„ frontmatter å’Œå…§å®¹çµæ§‹åŒ–æ”¯æ´
- âœ… å…§å»ºåœ–ç‰‡è™•ç†å’Œæœ€ä½³åŒ–
- âœ… æ•ˆèƒ½å„ªç•°ï¼Œç·¨è­¯æ™‚é è™•ç†æ‰€æœ‰å…§å®¹

**æŠ€è¡“åŸç†**ï¼š
```typescript
// Contentlayer çš„å·¥ä½œæ–¹å¼
const post = allPosts.find(p => p.slug === slug)           // ç·¨è­¯æ™‚ç”Ÿæˆçš„è³‡æ–™
const MDXContent = getMDXComponent(post.body.code)         // é ç·¨è­¯çš„ React å…ƒä»¶ç¨‹å¼ç¢¼
return <MDXContent components={useMDXComponents({})} />    // ç›´æ¥æ¸²æŸ“ï¼Œç„¡éœ€åŸ·è¡Œæ™‚ç·¨è­¯
```

### ç‚ºä»€éº¼ package.json ä¸­é‚„æœ‰ next-mdx-remoteï¼Ÿ
- `next-mdx-remote` åœ¨ `package.json` ä¸­ä½†æ²’æœ‰å¯¦éš›ä½¿ç”¨
- é€™æ˜¯æŠ€è¡“é¸æ“‡æ¼”é€²éç¨‹çš„éºç•™ï¼Œç™¼ç¾å®ƒä¸æ”¯æ´éœæ…‹åŒ¯å‡ºå¾Œå°±æ”¹ç”¨ Contentlayer
- ä¿ç•™æ˜¯ç‚ºäº†è¨˜éŒ„æŠ€è¡“æ±ºç­–éç¨‹

### é—œéµæŠ€è¡“å·®ç•°ç¸½çµ

| ç‰¹æ€§ | @next/mdx | next-mdx-remote | Contentlayer |
|------|-----------|-----------------|--------------|
| Next.js 13 æ”¯æ´ | âŒ Bug çœ¾å¤š | âœ… è‰¯å¥½ | âœ… å®Œç¾ |
| éœæ…‹åŒ¯å‡ºæ”¯æ´ | âŒ ä¸ç©©å®š | âŒ ä¸æ”¯æ´ | âœ… å®Œç¾æ”¯æ´ |
| è™•ç†æ™‚æ©Ÿ | ç·¨è­¯æ™‚ | åŸ·è¡Œæ™‚ | ç·¨è­¯æ™‚ |
| TypeScript æ”¯æ´ | åŸºæœ¬ | åŸºæœ¬ | âœ… è‡ªå‹•ç”Ÿæˆå‹åˆ¥ |
| å…§å®¹ç®¡ç† | åŸºæœ¬ | éˆæ´» | âœ… çµæ§‹åŒ–ç®¡ç† |
| æ•ˆèƒ½ | å¥½ | è¼ƒå·® | âœ… æœ€ä½³ |

### æœ€çµ‚æ¶æ§‹
- **å…§å®¹ä¾†æº**ï¼š`content/` ç›®éŒ„ä¸‹çš„ MDX æª”æ¡ˆ
- **ç·¨è­¯å·¥å…·**ï¼šContentlayer åœ¨å»ºç½®æ™‚è™•ç†æ‰€æœ‰ MDX
- **å‹åˆ¥å®‰å…¨**ï¼šè‡ªå‹•ç”Ÿæˆçš„ TypeScript å‹åˆ¥ï¼ˆ`contentlayer/generated`ï¼‰
- **æ¸²æŸ“æ–¹å¼**ï¼š`getMDXComponent()` + `useMDXComponents()`
- **è‡ªè¨‚å…ƒä»¶**ï¼šé€é `mdx-components.tsx` æä¾›è‡ªè¨‚ MDX å…ƒä»¶æ˜ å°„

é€™å€‹æŠ€è¡“é¸æ“‡éç¨‹å®Œç¾é«”ç¾äº†ã€Œé¸æ“‡é©åˆå°ˆæ¡ˆéœ€æ±‚çš„æŠ€è¡“ã€çš„é‡è¦æ€§ã€‚

## Typography
- Font Implementation:
  - Using next/font/local for optimal performance
  - Fonts are locally hosted in /public/fonts/
  - Default font settings are configured in app/layout.tsx body tag
  - Font loading strategy: 'swap' for better performance

## Project Structure
/
â”œâ”€â”€ app/                    # Next.js app router pages and components
â”œâ”€â”€ content/               # MDX content files
â”œâ”€â”€ .contentlayer/         # Generated content layer files
â”œâ”€â”€ public/               # Static assets
â”œâ”€â”€ scripts/              # Utility scripts (image processing etc.)
â”œâ”€â”€ types/                # TypeScript type definitions
â””â”€â”€ components/           # Reusable React components

## Configuration Files
- next.config.js          # Next.js configuration
- contentlayer.config.ts  # Content layer configuration
- tailwind.config.ts     # Tailwind CSS configuration
- tsconfig.json          # TypeScript configuration
- postcss.config.js      # PostCSS configuration
- eslint.config.mjs      # ESLint configuration

## Build and Development
- Development: `npm run dev`
- Production Build: `npm run build` (Generates static files in /out)
- Preview: `npm run preview` (Serves static files from /out)
- Content Tools: 
  - Image Upload: `npm run upload-images`
  - Image Upload Test: `npm run upload-images:test`
  - Generate Image Sitemap: `npm run generate-image-sitemap`

## Node.js è…³æœ¬é‹è¡Œç’°å¢ƒè©³è§£

### èƒŒæ™¯ï¼šåŸå§‹åœ–ç‰‡è™•ç†ç³»çµ±
ä½ åŸæœ¬å»ºç«‹é€™å€‹ Node.js ç’°å¢ƒæ˜¯ç‚ºäº†é‹è¡Œåœ–ç‰‡æ‰¹é‡ä¸Šå‚³åˆ° Cloudinary çš„è…³æœ¬ï¼š
- `npm run upload-images` - æ‰¹é‡ä¸Šå‚³æ‰€æœ‰åœ–ç‰‡
- `npm run upload-images:test` - æ¸¬è©¦å–®ä¸€æ–‡ç« çš„åœ–ç‰‡ä¸Šå‚³

### 1. ç‚ºä»€éº¼éœ€è¦ç‰¹æ®Šçš„ Node.js è¨­å®šï¼Ÿ

**å•é¡Œ**ï¼šä½ çš„åœ–ç‰‡è™•ç†è…³æœ¬æ˜¯ç”¨ TypeScript å¯«çš„ï¼ˆ`.mts` æª”æ¡ˆï¼‰ï¼Œä½† Node.js åŸç”Ÿä¸æ”¯æ´ç›´æ¥åŸ·è¡Œ TypeScriptã€‚

**è§£æ±ºæ–¹æ¡ˆ**ï¼šå»ºç«‹ä¸€å€‹ç‰¹æ®Šçš„åŸ·è¡Œç’°å¢ƒï¼Œè®“ Node.js å¯ä»¥ç›´æ¥é‹è¡Œ TypeScript æª”æ¡ˆã€‚

### 2. è¨­å®šæª”æ¡ˆè§£æ

#### `scripts/package.json`
```json
{
  "type": "module",
  "private": true
}
```
- **ä½œç”¨**ï¼šå‘Šè¨´ Node.js é€™å€‹ç›®éŒ„ä¸‹çš„æ‰€æœ‰ `.js` æª”æ¡ˆéƒ½æ˜¯ ES Module æ ¼å¼
- **ç‚ºä»€éº¼éœ€è¦**ï¼šç¾ä»£ JavaScript èªæ³•ï¼Œæ”¯æ´ `import/export`

#### `scripts/register.mjs`
```javascript
import { register } from 'node:module';
import { pathToFileURL } from 'node:url';

register('ts-node/esm', pathToFileURL('./'));
```
- **ä½œç”¨**ï¼šé€™æ˜¯ä¸€å€‹ã€Œè¼‰å…¥å™¨è¨»å†Šå™¨ã€
- **åŠŸèƒ½**ï¼šå‘Šè¨´ Node.js å¦‚ä½•è™•ç† TypeScript æª”æ¡ˆ
- **çµæœ**ï¼šNode.js ç¾åœ¨å¯ä»¥ç›´æ¥åŸ·è¡Œ `.ts` å’Œ `.mts` æª”æ¡ˆ

### 3. åŸ·è¡Œå‘½ä»¤è§£æ

#### åŸå§‹åœ–ç‰‡ä¸Šå‚³å‘½ä»¤
```bash
node --import ./scripts/register.mjs scripts/image-processor/index.mts
```

#### æ–°çš„ sitemap ç”Ÿæˆå‘½ä»¤
```bash
node --import ./scripts/register.mjs scripts/generate-image-sitemap.js
```

**åŸ·è¡Œæµç¨‹**ï¼š
1. `node` å•Ÿå‹•
2. `--import ./scripts/register.mjs` è¼‰å…¥ TypeScript æ”¯æ´
3. åŸ·è¡Œä¸»è…³æœ¬ï¼ˆå¯ä»¥æ˜¯ `.mts` æˆ– `.js`ï¼‰

### 4. åœ–ç‰‡è™•ç†è…³æœ¬æ¶æ§‹

ä½ çš„åŸå§‹ `scripts/image-processor/` åŒ…å«ï¼š
- `index.mts` - ä¸»è¦åŸ·è¡Œæª”æ¡ˆ
- `cloudinaryUploader.mts` - Cloudinary ä¸Šå‚³é‚è¼¯
- `imageCollector.mts` - MDX åœ–ç‰‡è§£æå™¨
- `pinterestPublisher.mts` - Pinterest ç™¼å¸ƒåŠŸèƒ½

### 5. æ–°è…³æœ¬å¦‚ä½•é‡ç”¨ç¾æœ‰åŸºç¤è¨­æ–½

æ–°çš„ `generate-image-sitemap.js` è…³æœ¬ï¼š
- **é‡ç”¨ç›¸åŒçš„åŸ·è¡Œç’°å¢ƒ**ï¼šä½¿ç”¨åŒæ¨£çš„ `register.mjs` è¼‰å…¥å™¨
- **é‡ç”¨ç¾æœ‰æ¨¡çµ„**ï¼šå‹•æ…‹å°å…¥ `imageCollector.mts` ä¾†è§£æ MDX åœ–ç‰‡
- **é‡ç”¨åœ–ç‰‡å·¥å…·**ï¼šå°å…¥ `app/utils/imageUtils.ts` ä¾†ç”Ÿæˆ URL

### 6. å‹•æ…‹å°å…¥çš„å¿…è¦æ€§

```javascript
// ç‚ºä»€éº¼ä¸èƒ½ç›´æ¥ importï¼Ÿ
// import { getCollectedImages } from './image-processor/imageCollector.mts'; // âŒ æœƒæœ‰è·¯å¾‘å•é¡Œ

// ç‚ºä»€éº¼è¦ç”¨å‹•æ…‹å°å…¥ï¼Ÿ
async function importImageCollector() {
  const { getCollectedImages } = await import('./image-processor/imageCollector.mts'); // âœ… é‹è¡Œæ™‚è§£æ
  return { getCollectedImages };
}
```

### 7. å¯¦éš›é‹ä½œæµç¨‹

ç•¶ä½ åŸ·è¡Œ `npm run generate-image-sitemap` æ™‚ï¼š

1. **Node.js å•Ÿå‹•** + è¼‰å…¥ TypeScript æ”¯æ´
2. **åŸ·è¡Œ sitemap è…³æœ¬**
3. **å‹•æ…‹å°å…¥åœ–ç‰‡è§£æå™¨**ï¼ˆé‡ç”¨ä½ çš„åŸå§‹å·¥å…·ï¼‰
4. **å‹•æ…‹å°å…¥åœ–ç‰‡ URL å·¥å…·**ï¼ˆé‡ç”¨ app ç›®éŒ„çš„å·¥å…·ï¼‰
5. **è®€å– Contentlayer è³‡æ–™**ï¼ˆé¿å…èªæ³•è¡çªï¼‰
6. **ç”Ÿæˆ sitemap XML**

### 8. ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆï¼Ÿ

- **é‡ç”¨ç¾æœ‰æŠ•è³‡**ï¼šä¸éœ€è¦é‡å¯«åœ–ç‰‡è™•ç†é‚è¼¯
- **ä¿æŒä¸€è‡´æ€§**ï¼šä½¿ç”¨ç›¸åŒçš„ Cloudinary è¨­å®šå’Œ URL æ ¼å¼
- **é¿å…é‡è¤‡**ï¼šä¸€å¥— TypeScript åŸ·è¡Œç’°å¢ƒæœå‹™å¤šå€‹è…³æœ¬
- **æ¨¡çµ„åŒ–è¨­è¨ˆ**ï¼šæ¯å€‹è…³æœ¬å°ˆæ³¨è‡ªå·±çš„åŠŸèƒ½ï¼Œä½†å¯ä»¥å…±äº«å·¥å…·

### 9. ç°¡å–®ç¸½çµ

ä½ åŸæœ¬ç‚ºäº†ä¸Šå‚³åœ–ç‰‡åˆ° Cloudinary å»ºç«‹äº†ä¸€å€‹ã€ŒNode.js å¯ä»¥åŸ·è¡Œ TypeScriptã€çš„ç’°å¢ƒã€‚ç¾åœ¨æ–°çš„ sitemap ç”Ÿæˆè…³æœ¬å°±åƒæ˜¯ä¸€å€‹æ–°æˆ¿å®¢ï¼Œæ¬é€²äº†åŒä¸€å€‹å·²ç¶“è£ä¿®å¥½çš„æˆ¿å­ï¼Œé‡ç”¨äº†ç›¸åŒçš„åŸºç¤è¨­æ–½å’Œå·¥å…·ã€‚ 

## Webpack èˆ‡ HTML è™•ç†æ©Ÿåˆ¶æ·±åº¦è§£æ

### ğŸ¯ æ ¸å¿ƒæ¦‚å¿µï¼šWebpack æœ¬èº«ä¸è² è²¬ HTML

**é—œéµèªçŸ¥**ï¼šWebpack åŸç”Ÿæ ¹æœ¬ä¸è™•ç† HTML æª”æ¡ˆï¼Œå®ƒæ˜¯ä¸€å€‹**æ¨¡çµ„æ‰“åŒ…å·¥å…·**ã€‚

#### Webpack çš„æœ¬è·å·¥ä½œç¯„åœ
```javascript
// âœ… Webpack åŸç”Ÿè™•ç†é€™äº›ï¼š
import React from 'react'           // JavaScript æ¨¡çµ„
import './styles.css'               // CSS æª”æ¡ˆ
import logo from './logo.png'       // åœ–ç‰‡è³‡æº
import data from './data.json'      // JSON æª”æ¡ˆ
```

```html
<!-- âŒ Webpack åŸç”Ÿä¸è™•ç†é€™äº›ï¼š -->
<html>                              <!-- HTML çµæ§‹ -->
  <head>...</head>                  <!-- HTML æ¨™ç±¤ -->
  <body>...</body>                  <!-- HTML å…§å®¹ -->
</html>
```

### ğŸ”Œ æ’ä»¶æ©Ÿåˆ¶ï¼šè®“ Webpack ç²å¾— HTML è™•ç†èƒ½åŠ›

#### æ²’æœ‰æ’ä»¶çš„ Webpack è¼¸å‡º
```bash
# ç´” Webpack æ‰“åŒ…çµæœï¼š
dist/
â”œâ”€â”€ main.js          # æ‰“åŒ…å¾Œçš„ JavaScript
â”œâ”€â”€ style.css        # æå–çš„ CSS
â”œâ”€â”€ logo.abc123.png  # è™•ç†å¾Œçš„åœ–ç‰‡
â””â”€â”€ (æ²’æœ‰ HTML æª”æ¡ˆ)  # âŒ ç„¡æ³•ç›´æ¥åœ¨ç€è¦½å™¨ä¸­é‹è¡Œ
```

#### HtmlWebpackPlugin çš„ä½œç”¨æ©Ÿåˆ¶
```javascript
// webpack.config.js
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  plugins: [
    new HtmlWebpackPlugin({
      template: './src/index.html',  // ğŸ“„ è®€å– HTML æ¨¡æ¿
      minify: {                      // ğŸ—œï¸ å£“ç¸® HTML é¸é …
        removeComments: true,
        collapseWhitespace: true,
        removeRedundantAttributes: true
      }
    })
  ]
}
```

**æ’ä»¶å·¥ä½œæµç¨‹**ï¼š
```
1. è®€å– HTML æ¨¡æ¿æª”æ¡ˆ
2. åˆ†æ Webpack æ‰“åŒ…çµæœï¼ˆJS/CSS æª”æ¡ˆåç¨±ï¼‰
3. è‡ªå‹•æ³¨å…¥ <script> å’Œ <link> æ¨™ç±¤
4. æ‡‰ç”¨ HTML å£“ç¸®è¨­å®š
5. è¼¸å‡ºæœ€çµ‚çš„ HTML æª”æ¡ˆ
```

**æœ‰æ’ä»¶çš„è¼¸å‡º**ï¼š
```bash
dist/
â”œâ”€â”€ main.js
â”œâ”€â”€ style.css  
â”œâ”€â”€ logo.abc123.png
â””â”€â”€ index.html       # âœ… è‡ªå‹•ç”Ÿæˆï¼ŒåŒ…å«æ‰€æœ‰è³‡æºé€£çµ
```

### ğŸ—ï¸ Next.js éœæ…‹åŒ¯å‡ºçš„ç‰¹æ®Šæƒ…æ³

#### å‚³çµ± SPA vs Next.js SSG çš„ HTML ç”Ÿæˆå°æ¯”

| éšæ®µ | å‚³çµ± Webpack SPA | Next.js éœæ…‹åŒ¯å‡º |
|------|------------------|------------------|
| **å»ºç½®å·¥å…·** | Webpack ä¸»å° | Next.js ä¸»å° |
| **HTML ç”Ÿæˆ** | HtmlWebpackPlugin | Next.js æ¸²æŸ“å¼•æ“ |
| **æ™‚æ©Ÿ** | Webpack ç·¨è­¯æ™‚ | React çµ„ä»¶æ¸²æŸ“æ™‚ |
| **å…§å®¹** | æ¨¡æ¿ + è³‡æºæ³¨å…¥ | å®Œæ•´æ¸²æŸ“çš„ HTML |

#### Next.js éœæ…‹åŒ¯å‡ºå·¥ä½œæµç¨‹è©³è§£

```typescript
// 1. å®šç¾©é é¢çµ„ä»¶
export default function ArticlePage({ params }) {
  const article = allArticles.find(a => a.slug === params.slug);
  return (
    <div>
      <h1>{article.title}</h1>
      <MDXContent />
    </div>
  );
}

// 2. å‘Šè¨´ Next.js è¦ç”Ÿæˆå“ªäº›é é¢
export async function generateStaticParams() {
  return allArticles.map(article => ({
    slug: article.slug  // ç”Ÿæˆæ¯å€‹æ–‡ç« çš„éœæ…‹é é¢
  }));
}
```

**Next.js å»ºç½®éç¨‹**ï¼š
```bash
# next build çš„å…§éƒ¨æµç¨‹ï¼š

1. Webpack éšæ®µ
   â”œâ”€â”€ è™•ç† JavaScript æ¨¡çµ„æ‰“åŒ…
   â”œâ”€â”€ è™•ç† CSS æå–å’Œå„ªåŒ–
   â”œâ”€â”€ è™•ç†åœ–ç‰‡ç­‰éœæ…‹è³‡æº
   â””â”€â”€ è¼¸å‡º .next/static/ æª”æ¡ˆ

2. Next.js æ¸²æŸ“éšæ®µï¼ˆWebpack ä¸åƒèˆ‡ï¼‰
   â”œâ”€â”€ åŸ·è¡Œ generateStaticParams()
   â”œâ”€â”€ ç‚ºæ¯å€‹é é¢åŸ·è¡Œ React æ¸²æŸ“
   â”œâ”€â”€ ç”Ÿæˆå®Œæ•´çš„ HTML å­—ç¬¦ä¸²
   â””â”€â”€ å¯«å…¥ out/[slug]/index.html

3. å¾Œè™•ç†éšæ®µï¼ˆå¯é¸ï¼‰
   â””â”€â”€ å¤–éƒ¨å·¥å…·è™•ç† HTMLï¼ˆå¦‚ html-minifier-terserï¼‰
```

### âŒ ç‚ºä»€éº¼ Webpack HTML æ’ä»¶åœ¨ Next.js éœæ…‹åŒ¯å‡ºä¸­ç„¡æ•ˆï¼Ÿ

#### æŠ€è¡“åŸå› åˆ†æ

```javascript
// âŒ åœ¨ next.config.js ä¸­é€™æ¨£åšç„¡æ•ˆï¼š
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  output: 'export',  // éœæ…‹åŒ¯å‡ºæ¨¡å¼
  webpack: (config) => {
    config.plugins.push(
      new HtmlWebpackPlugin({
        minify: true  // âŒ é€™å€‹é…ç½®ä¸æœƒç”Ÿæ•ˆ
      })
    );
    return config;
  }
}
```

**ç„¡æ•ˆçš„æ ¹æœ¬åŸå› **ï¼š
1. **æ™‚æ©Ÿè¡çª**ï¼šWebpack åœ¨ç·¨è­¯æ™‚é‹è¡Œï¼ŒNext.js åœ¨æ¸²æŸ“æ™‚ç”Ÿæˆ HTML
2. **è·è²¬åˆ†é›¢**ï¼šWebpack è² è²¬è³‡æºæ‰“åŒ…ï¼ŒNext.js è² è²¬ HTML ç”Ÿæˆ  
3. **æµç¨‹éš”é›¢**ï¼šHTML ç”Ÿæˆç™¼ç”Ÿåœ¨ Webpack è™•ç†å®Œæˆä¹‹å¾Œ

#### åŸ·è¡Œé †åºè©³è§£

```bash
# éŒ¯èª¤ç†è§£çš„æµç¨‹ï¼š
Webpack é–‹å§‹ â†’ HTML æ’ä»¶ç”Ÿæˆ HTML â†’ çµæŸ
                â†‘ æœŸæœ›åœ¨é€™è£¡å£“ç¸® HTML

# å¯¦éš›çš„ Next.js æµç¨‹ï¼š
Webpack é–‹å§‹ â†’ è™•ç† JS/CSS â†’ Webpack çµæŸ
                                â†“
Next.js é–‹å§‹ â†’ æ¸²æŸ“çµ„ä»¶ â†’ ç”Ÿæˆ HTML â†’ Next.js çµæŸ
                           â†‘ Webpack æ’ä»¶ç„¡æ³•è§¸åŠé€™å€‹éšæ®µ
```

### âœ… æ­£ç¢ºçš„è§£æ±ºæ–¹æ¡ˆï¼šå¾Œè™•ç†æ¶æ§‹

#### ç•¶å‰å°ˆæ¡ˆçš„è§£æ±ºæ–¹æ¡ˆ

```json
// package.json ä¸­çš„ build è…³æœ¬
{
  "scripts": {
    "build": "next build && next-sitemap && npm run generate-image-sitemap:vercel && cp -r public/sitemap*.xml public/robots.txt public/image-sitemap.xml out/ && html-minifier-terser --input-dir ./out --output-dir ./out --file-ext html --collapse-whitespace --remove-comments --remove-optional-tags --remove-redundant-attributes --remove-script-type-attributes --remove-tag-whitespace --use-short-doctype --minify-css true --minify-js true"
  }
}
```

**å®Œæ•´æµç¨‹åˆ†è§£**ï¼š
```bash
1. next build
   â””â”€â”€ ç”Ÿæˆæœªå£“ç¸®çš„ HTML åˆ° out/ ç›®éŒ„

2. next-sitemap  
   â””â”€â”€ ç”Ÿæˆç¶²ç«™åœ°åœ–

3. npm run generate-image-sitemap:vercel
   â””â”€â”€ ç”Ÿæˆåœ–ç‰‡ç¶²ç«™åœ°åœ–

4. cp -r public/sitemap*.xml ... out/
   â””â”€â”€ è¤‡è£½å…¬å…±æª”æ¡ˆåˆ°è¼¸å‡ºç›®éŒ„

5. html-minifier-terser --input-dir ./out --output-dir ./out ...
   â””â”€â”€ å¾Œè™•ç†å£“ç¸®æ‰€æœ‰ HTML æª”æ¡ˆ
```

### ğŸ”§ æŠ€è¡“å·¥å…·å°æ¯”èˆ‡é¸æ“‡

#### JavaScript/CSS å£“ç¸®ï¼šterser-webpack-plugin

```javascript
// next.config.js - æ­£ç¢ºä½¿ç”¨ Webpack æ’ä»¶
const TerserPlugin = require('terser-webpack-plugin')

module.exports = {
  webpack: (config, { dev, isServer }) => {
    if (!dev && !isServer) {
      config.optimization.minimizer = [
        new TerserPlugin({
          terserOptions: {
            compress: {
              drop_console: true,     // âœ… ç§»é™¤ console.log
              drop_debugger: true,    // âœ… ç§»é™¤ debugger
            },
            mangle: {
              safari10: true,         // âœ… æ··æ·†è®Šæ•¸åç¨±
            }
          }
        })
      ];
    }
    return config;
  }
}
```

**ç‚ºä»€éº¼é€™å€‹æœ‰æ•ˆ**ï¼š
- JavaScript/CSS è™•ç†åœ¨ Webpack éšæ®µå®Œæˆ
- TerserPlugin åœ¨æ­£ç¢ºçš„æ™‚æ©Ÿé‹è¡Œ
- ä¸ä¾è³´æ–¼ Next.js çš„ HTML æ¸²æŸ“éç¨‹

#### HTML å£“ç¸®ï¼šhtml-minifier-terserï¼ˆå¾Œè™•ç†ï¼‰

```bash
# å¾Œè™•ç†å‘½ä»¤è©³è§£
html-minifier-terser \
  --input-dir ./out \              # è¼¸å…¥ç›®éŒ„
  --output-dir ./out \             # è¼¸å‡ºç›®éŒ„ï¼ˆè¦†è“‹åŸæª”æ¡ˆï¼‰
  --file-ext html \                # è™•ç† .html æª”æ¡ˆ
  --collapse-whitespace \          # ç§»é™¤å¤šé¤˜ç©ºç™½
  --remove-comments \              # ç§»é™¤ HTML è¨»è§£
  --remove-optional-tags \         # ç§»é™¤å¯é¸æ¨™ç±¤
  --minify-css true \              # å£“ç¸®å…§åµŒ CSS
  --minify-js true                 # å£“ç¸®å…§åµŒ JavaScript
```

### ğŸ“š æ·±åº¦å­¸ç¿’è¦é»

#### 1. å·¥å…·è·è²¬é‚Šç•Œç†è§£
- **Webpack**ï¼šæ¨¡çµ„æ‰“åŒ…ï¼Œè³‡æºè™•ç†ï¼Œç·¨è­¯æ™‚å„ªåŒ–
- **Next.js**ï¼šé é¢æ¸²æŸ“ï¼Œè·¯ç”±ç”Ÿæˆï¼ŒHTML è¼¸å‡º
- **å¾Œè™•ç†å·¥å…·**ï¼šæª”æ¡ˆç´šåˆ¥çš„æœ€çµ‚å„ªåŒ–

#### 2. æ™‚æ©Ÿèˆ‡é †åºçš„é‡è¦æ€§
- ç·¨è­¯æ™‚ vs æ¸²æŸ“æ™‚ vs å¾Œè™•ç†æ™‚æ©Ÿ
- æ¯å€‹å·¥å…·åœ¨æ­£ç¢ºçš„æ™‚æ©Ÿç™¼æ®ä½œç”¨
- éŒ¯èª¤çš„æ™‚æ©Ÿé…ç½®æœƒå°è‡´åŠŸèƒ½å¤±æ•ˆ

#### 3. éœæ…‹ç¶²ç«™çš„ç‰¹æ®Šè€ƒé‡
- éœæ…‹åŒ¯å‡ºé™åˆ¶äº†æŸäº› Webpack æ’ä»¶çš„ä½¿ç”¨
- éœ€è¦å¾Œè™•ç†æ–¹æ¡ˆä¾†å½Œè£œåŠŸèƒ½ç¼ºå£
- ç†è§£ SSG èˆ‡ SPA çš„æœ¬è³ªå·®ç•°

#### 4. å¯¦è¸ä¸­çš„æ¬Šè¡¡å–æ¨
- é¸æ“‡åˆé©çš„å·¥å…·çµ„åˆ
- ç†è§£æ¯å€‹å·¥å…·çš„é™åˆ¶å’Œé©ç”¨å ´æ™¯
- å»ºç«‹ç©©å®šå¯é çš„å»ºç½®æµç¨‹

é€™å€‹çŸ¥è­˜æ¶æ§‹å¹«åŠ©ç†è§£ç¾ä»£å‰ç«¯å»ºç½®å·¥å…·çš„è¤‡é›œæ€§å’Œç›¸äº’é—œä¿‚ï¼Œé¿å…å¸¸è¦‹çš„é…ç½®éŒ¯èª¤å’Œæ¦‚å¿µæ··æ·†ã€‚ 